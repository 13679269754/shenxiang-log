| operator | createtime | updatetime |
| ---- | ---- | ---- |
| shenx | 2025-3月-03 | 2025-3月-03  |
| ... | ... | ... |
---
# redis 搭建

[toc]

## 安装redis服务

```bash
mkdir /usr/local/data
tar -zxvf redis-6.2.11.tar.gz 
cd  redis-6.2.11
make  install

## redis 实例目录
mkdir -p /usr/local/data/redis/6000
mkdir /usr/local/data/redis/6000/data
mkdir /usr/local/data/redis/6000/conf
mkdir /usr/local/data/redis/6000/run
mkdir /usr/local/data/redis/6000/log

## redis sentinel目录
mkdir -p /usr/local/data/redis/26000
mkdir /usr/local/data/redis/26000/sentinel_data
mkdir /usr/local/data/redis/26000/conf
mkdir /usr/local/data/redis/26000/run
mkdir /usr/local/data/redis/26000/log

```

## 配置文件

redis实例
vim /usr/local/data/redis/6000/conf/redis.conf

```bash
daemonize yes
bind 0.0.0.0
protected-mode no
timeout 0
tcp-keepalive 0
loglevel notice
databases 10
rdbchecksum yes
rdbcompression yes
replica-serve-stale-data no
replica-read-only yes
repl-ping-replica-period 10
repl-timeout 60
repl-disable-tcp-nodelay no
replica-priority 100
rename-command flushdb cleandb
rename-command flushall cleanall
rename-command debug nobug
rename-command keys nokeys
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 70
auto-aof-rewrite-min-size 64mb
lua-time-limit 5000
stop-writes-on-bgsave-error yes
slowlog-log-slower-than 10000
slowlog-max-len 1024
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-entries 512
list-max-ziplist-value 64
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 512mb 512mb 300
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
maxclients 65504

# Generated by CONFIG REWRITE
aof-use-rdb-preamble no
appendonly yes

pidfile "/usr/local/data/redis/6000/run/redis.pid"
masterauth "1hpAACExDKv5yZhN"
requirepass "1hpAACExDKv5yZhN"
port 6000
maxmemory 23437500kb
logfile "/usr/local/data/redis/6000/log/redis.log"
save 3600 1
save 300 100
save 60 10000
user default on sanitize-payload #7dc2677b1ebeba1b4db96fdbf00b628c84f546092d55f0d85034b69b39bb1956 ~* &* +@all
dir "/usr/local/data/redis/6000/data"

## replicaof 10.159.65.123 6000
```

主从关系请配置replicaof: 表示主库的ip

```bash
daemonize yes
port 26000
dir "/usr/local/data/redis/26000/sentinel_data"
logfile "/usr/local/data/redis/26000/log/sentinel-26000.log"
sentinel monitor master-hty-6000 10.159.65.123 6000 2
sentinel auth-pass master-hty-6000 1hpAACExDKv5yZhN
sentinel down-after-milliseconds master-hty-6000 20000
```