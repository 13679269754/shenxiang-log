## k8s 学习 1

## 参考
[kubernetes-handbook/introduction/101.md at master · feiskyer/kubernetes-handbook](https://github.com/feiskyer/kubernetes-handbook/blob/master/introduction/101.md)

## 创建一个 pod

### 管理命令
```bash
# 创建
kubectl run --image=nginx:alpine nginx-app --port=80
```

- `kubectl get` - 类似于 `docker ps`，查询资源列表
- `kubectl describe` - 类似于 `docker inspect`，获取资源的详细信息
- `kubectl logs` - 类似于 `docker logs`，获取容器的日志
- `kubectl exec` - 类似于 `docker exec`，在容器内执行一个命令
  
### 使用yaml 定义一个pod

[[使用yaml 定义一个pod(生产)]]


### 创建service

```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-app-service  # Service 名称（自定义，便于识别）
  namespace: default       # 与 Pod 同命名空间（否则无法关联）
spec:
  selector:
    run: nginx-app         # 关键：标签选择器，必须与 Pod 的标签完全一致
  ports:
  - port: 80               # Service 暴露的端口（集群内访问用，如 http://nginx-app-service:80）
    targetPort: 80         # 对应 Pod 内容器的端口（Nginx 实际监听的端口）
    protocol: TCP          # 协议（默认 TCP，可省略）
  type: NodePort           # 暴露类型（NodePort/ClusterIP/LoadBalancer，根据需求选择）
```

### 拓展应用

```bash
$ kubectl scale --replicas=3 deployment/nginx-app
$ kubectl get deploy
NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-app   3         3         3            3           10m
```

### 滚动升级

**ReplicationController** 
```bash
# 滚动更新
kubectl rolling-update frontend-v1 frontend-v2 --image=image:v2

# 回滚
kubectl rolling-update frontend-v1 frontend-v2 --rollback

# 

```

pod 更新策略


**RollingUpdate -- Deployment**  （默认更新策略，会自动滚动更新）
应用更新策略
```bash
kubectl set image deployment/nginx-app nginx-app=nginx:1.9.1
```


查看滚动升级
```bash
kubectl rollout status deployment/nginx-app

# 回滚
kubectl rollout undo deployment/nginx-app

```

### 健康检查

[[k8s 健康检查]]
### 资源限制

```bash
kubectl set resources deployment nginx-app -c=nginx --limits=cpu=500m,memory=128Mi
```
