> `tls: failed to verify certificate: x509: certificate signed by unknown authority`

è¯´æ˜ **Harbor çš„è‡ªç­¾ CA æ²¡æœ‰è¢« containerd ä¿¡ä»»**ã€‚ä¹Ÿå°±æ˜¯è¯´è¯ä¹¦ç”Ÿæˆå’Œ Harbor é…ç½®æ²¡é—®é¢˜ï¼Œä½† **k8s èŠ‚ç‚¹çš„è¿è¡Œæ—¶è¿˜ä¸è®¤è¯†ä½ çš„ CA**ã€‚æˆ‘ä»¬æ¥é€æ­¥æ’æŸ¥ï¼š

---

## ğŸ” æ’æŸ¥è¦ç‚¹

1. **ç¡®è®¤è¯ä¹¦ç›®å½•ç»“æ„**
    
    - å¯¹äº **containerd**ï¼Œå¿…é¡»æ˜¯ï¼š
        
        ```
        /etc/containerd/certs.d/172.29.105.240/ca.crt
        ```
        
        æ³¨æ„ï¼šç›®å½•åå¿…é¡»å’Œä½ è®¿é—® Harbor çš„åœ°å€å®Œå…¨ä¸€è‡´ï¼ˆè¿™é‡Œæ˜¯ `172.29.105.240`ï¼Œä¸èƒ½å†™æˆ `https://172.29.105.240` æˆ–å¸¦ç«¯å£ï¼‰ã€‚
2. **ç¡®è®¤ ca.crt å†…å®¹**
    
    - ä½ æ”¾è¿›å»çš„ `ca.crt` å¿…é¡»æ˜¯ **æ ¹è¯ä¹¦**ï¼ˆCAï¼‰ï¼Œè€Œä¸æ˜¯ `harbor.crt`ã€‚
    - æ£€æŸ¥ï¼š
        
        ```bash
        openssl x509 -in /etc/containerd/certs.d/172.29.105.240/ca.crt -noout -text | grep "CA:TRUE"
        ```
        
        å¦‚æœæ²¡æœ‰ `CA:TRUE`ï¼Œè¯´æ˜ä½ æ”¾é”™äº†æ–‡ä»¶ã€‚
3. **é‡å¯ containerd**
    
    ```bash
    systemctl restart containerd
    ```
    
4. **æµ‹è¯•ä¿¡ä»»é“¾** åœ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š
    
    ```bash
    curl -v https://172.29.105.240/v2/ --cacert /etc/containerd/certs.d/172.29.105.240/ca.crt
    ```
    
    - å¦‚æœè¿”å› `{}` â†’ Harbor è¯ä¹¦é“¾æ²¡é—®é¢˜ï¼Œcontainerd åº”è¯¥ä¹Ÿèƒ½ç”¨ã€‚
    - å¦‚æœæŠ¥é”™ â†’ Harbor è¯ä¹¦æˆ– SAN é…ç½®æœ‰é—®é¢˜ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆã€‚

---

## âš¡ å¸¸è§å‘

- **SAN æ²¡å†™ IP**ï¼šè¯ä¹¦é‡Œå¿…é¡»æœ‰ `subjectAltName = IP:172.29.105.240`ï¼Œå¦åˆ™éªŒè¯å¤±è´¥ã€‚
- **èŠ‚ç‚¹è®¿é—®åœ°å€ä¸ä¸€è‡´**ï¼šå¦‚æœä½ ç”¨ `172.29.105.240` ç”Ÿæˆè¯ä¹¦ï¼Œä½† Pod é…ç½®é‡Œå†™äº† `https://harbor.local`ï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚
- **è¯ä¹¦é“¾ä¸å®Œæ•´**ï¼šå¦‚æœ Harbor é…ç½®äº† `harbor.crt`ï¼Œä½†é‡Œé¢æ²¡åŒ…å«ä¸­é—´ CAï¼Œéœ€è¦æŠŠå®Œæ•´é“¾ï¼ˆserver cert + CA certï¼‰æ‹¼åœ¨ä¸€èµ·ã€‚

---

## âœ… å»ºè®®æ“ä½œé¡ºåº

1. ç¡®è®¤ `/etc/containerd/certs.d/172.29.105.240/ca.crt` æ˜¯ **CA æ ¹è¯ä¹¦**ã€‚
2. ç¡®è®¤ Harbor çš„ `harbor.crt` é‡Œ SAN åŒ…å« `IP:172.29.105.240`ã€‚
3. é‡å¯ containerdã€‚
4. ç”¨ `curl --cacert` æµ‹è¯•ã€‚
5. å†ç”¨ `crictl pull` æµ‹è¯•ã€‚
