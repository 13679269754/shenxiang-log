2025-08-27
1. mysql 合并行复制三个配置
```sql
set global slave_parallel_type='LOGICAL_CLOCK';
set global slave_parallel_workers=8
set global binlog_transaction_dependency_tracking = 'WRITESET';
   ```

2. mysqlsh 几个基本操作

```bash
## 登录
 MySQL  JS > \connect root@172.29.105.240

################ 模式切换 ###################
## // 切换到 SQL 模式（执行 SQL 语句）
\sql

## // 切换到 JavaScript 模式（默认，适合集群管理）
\js

## // 切换到 Python 模式（需支持）
\py

## // 查看帮助（列出所有可用命令）
\help

## // 退出 mysqlsh
\exit 或 \q


#################   集群搭建   #################
## 验证搭建innodb_cluster 的前置
 MySQL  localhost:33060+  JS > dba.checkInstanceConfiguration('dzjroot@172.29.105.240')
 
## 创建集群
 var cluster = dba.createCluster('my_innodb_cluster')

## 获取当前集群
 var cluster = dba.createCluster()

## 清除集群信息
 dba.dropMetadataSchema()

## 查看集群信息
 cluster.status()

## 删除集群
 cluster.dissolve()

################# 集群高可用操作 ##################

## // 手动切换主节点（单主模式下，指定新主节点）
cluster.setPrimaryInstance('172.29.105.241:3306');

## // 将集群切换为多主模式（所有节点可读写，需谨慎使用）
cluster.switchToMultiPrimaryMode();

## // 切换回单主模式（默认模式，仅一个主节点可写）
cluster.switchToSinglePrimaryMode();

##  // 从完全故障中重启集群（所有节点离线后恢复）
var cluster = dba.rebootClusterFromCompleteOutage('my_innodb_cluster');


################## 实例管理 ##################
## 添加节点
cluster.addInstance('dzjroot@172.29.105.241')  # 输入 node2 的 root 密码

## 移除节点
cluster.removeInstance('172.29.105.240');

## // 暂停节点（临时脱离集群，保留数据）
cluster.pauseInstance('172.29.105.241:3306');

## // 恢复暂停的节点
cluster.resumeInstance('172.29.105.241:3306');

## // 查看实例的复制状态（如延迟情况）
cluster.status({extended: 1});  // extended 显示更详细的复制信息

```

