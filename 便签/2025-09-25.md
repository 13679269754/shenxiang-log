2025-09-25

## innodb_support_xa` 与两阶段提交的关联

在 MySQL 中，即使是单实例事务，InnoDB 与 Binlog 也通过 **两阶段提交** 保证一致性：

1. 阶段 1：InnoDB 执行事务的 “准备（Prepare）” 操作，写入 Redo Log 并刷盘，标记事务为 “可提交”；
2. 阶段 2：MySQL Server 层写入 Binlog 并刷盘，然后通知 InnoDB 执行 “提交（Commit）” 操作。

而 XA 事务在此基础上增加了跨资源的协调逻辑，`innodb_support_xa=ON` 时，InnoDB 会生成额外的 XA 日志记录，确保分布式事务中多个参与者的提交状态可追溯，避免单点故障导致的日志不一致。

## undo  log 

undo log hearder 
undo log record 
	insert undo log record
	update undo log record 

问：为什么 undo log 要区分 insert与update 
答：涉及到undo log 的回收，insert undo log 只需要插入成功即可被回收；而update undo log 由于要满足mvcc 所以，不能在事务完成后立即被回收。
