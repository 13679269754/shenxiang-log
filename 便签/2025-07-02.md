| operator | createtime | updatetime |
| ---- | ---- | ---- |
| shenx | 2025-7月-02 | 2025-7月-02  |
| ... | ... | ... |
---
# 2025-07-02

[toc]

1. innodb_undo_log_truncate 默认开启，让mysql自动收缩undo表空间



2. mysql8.0.20 支持了binlog 的压缩如果性能瓶颈时，网络带宽、压缩功能可以有效缓解主从延迟；但是如果性能瓶颈是本机自身处理能力，那么压缩功能反而可能加大主从延迟。

3.  xtrabackup --backup --stream | pv -q -L10m ssh user@desthost “cat - > /data/backups/backup.xbstream” 使用管道查看器工具将吞吐量限制为10MB/秒

4.MEB(MySQL 企业备份)三种特性
backup lock -- xtrabackup 已经支持
Redo Log Archiving
Page Tracking -- 增量备份

page tracking

-------------------------------------------------

### MySQL 企业备份(MEB)的三种特性详解

#### 一、Backup Lock 特性
**含义**：Backup Lock 是一种在备份过程中确保数据一致性的机制，目前已被 XtraBackup 工具支持。

**核心功能**：
- 在备份时通过获取全局读锁（FTWRL，Flush Tables With Read Lock）锁定数据库，确保备份期间数据不会被修改
- 与传统锁机制相比，Backup Lock 能更精准地控制备份期间的写入操作
- 支持在备份过程中记录二进制日志（Binlog），保证备份可恢复到任意时间点

**工作原理**：
1. 启动备份时获取全局读锁，阻止写入操作
2. 记录当前二进制日志位置（Binlog Position）
3. 释放锁并继续备份非事务表（如 MyISAM）
4. 对于事务表（InnoDB），利用其事务特性确保数据一致性
5. 最终通过 Binlog 实现增量恢复

**与 XtraBackup 的结合**：
XtraBackup 通过 `--backup-lock` 参数启用该特性，替代传统的 `--lock-all-tables`，减少备份对业务的影响，尤其适合大型数据库备份。


#### 二、Redo Log Archiving（重做日志归档）
**含义**：Redo Log Archiving 是将数据库重做日志（Redo Log）归档保存的机制，用于增强数据恢复能力。

**核心功能**：
- 实时或定时归档 InnoDB 重做日志（ib_logfile）
- 归档文件可独立于数据库存储，防止因数据库故障导致日志丢失
- 结合二进制日志（Binlog），支持从任何归档点进行时间点恢复（Point-In-Time Recovery）

**工作流程**：
1. 重做日志写入 InnoDB 日志文件（ib_logfile0/1）
2. 达到指定条件（如日志切换、定时任务）时，将日志归档到指定位置
3. 归档文件包含完整的事务重做信息
4. 恢复时，先应用备份数据，再按顺序应用归档的 Redo Log 和 Binlog

**应用场景**：
- 跨数据中心容灾：通过归档日志同步实现异地恢复
- 长期数据保留：归档日志可独立存储，满足合规性要求
- 快速增量恢复：无需全量备份即可恢复到特定时间点


#### 三、Page Tracking（页面跟踪）
**含义**：Page Tracking 是实现增量备份的核心技术，通过跟踪数据页变更来减少备份数据量。

**核心功能**：
- 记录数据库中每个数据页（Data Page）的最后修改时间或版本号
- 增量备份时仅备份自上次备份后发生变更的页面
- 支持基于时间点或版本的增量备份策略
- 大幅减少备份时间和存储空间占用

**技术实现**：
1. 在 InnoDB 存储引擎中维护页面变更记录表（Page Change Tracking Table）
2. 每次数据修改时标记对应页面为"已变更"
3. 增量备份时扫描变更表，仅备份标记的页面
4. 备份完成后重置变更标记，为下次增量备份做准备

**优势对比**：
| 特性         | 传统全量备份       | 基于 Page Tracking 的增量备份     |
|--------------|--------------------|-----------------------------------|
| 备份时间     | 长（全量数据）     | 短（仅变更页面）                  |
| 存储空间     | 大（全量数据）     | 小（增量数据）                    |
| 对业务影响   | 高（IO 压力大）    | 低（仅处理变更页面）              |
| 恢复效率     | 需全量应用         | 可按增量顺序应用，恢复更快        |

**典型应用**：
- 每日全量备份 + 每小时增量备份的组合策略
- 数据库频繁变更场景下的高效备份（如电商订单系统）
- 云数据库环境中节省存储成本和网络带宽


### 特性组合应用场景
- **全量备份 + Backup Lock**：用于首次完整备份，确保数据一致性
- **增量备份 + Page Tracking**：后续备份仅处理变更数据，提升效率
- **Redo Log Archiving + Binlog**：结合归档日志和二进制日志，实现任意时间点恢复

通过这三种特性的组合，MEB 提供了完整的企业级备份解决方案，满足高可用性、数据一致性和恢复效率的多重需求。