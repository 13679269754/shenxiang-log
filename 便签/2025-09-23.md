2025-09-23
## 刷盘关键参数
innodb_flush_log_at_trx_commit

redo log 刷新条件
1. master thread 每秒进行刷新
2. redo log buffer 使用大于1/2进行刷新
3. 事务提交刷新
	innodb_flush_log_at_trx_commit {0/1/2} 

sync_binlog


| 参数值 | 刷盘目标                | 事务提交时调用的方法 | 是否等待物理写入 | 数据丢失风险                          | 性能     |
|--------|-------------------------|----------------------|------------------|---------------------------------------|----------|
| 1      | 物理磁盘                | `fsync()`            | 是               | 无（最安全）                          | 最低     |
| 0      | Log Buffer（内存）      | 无                   | 否               | 最后 1 秒数据（数据库/服务器崩溃）    | 最高     |
| 2      | 操作系统缓存（OS Cache） | `write()`            | 否               | 最后 1 秒数据（仅操作系统崩溃时）      | 较高     |

### 组提交

binlog_group_commit_sync_delay

binlog_group_commit_sync_no_delay_count

问：innodb_flush_log_at_trx_commit =1 考虑到组提交是不是可以认为mysql 停机可能会丢掉一组事务，而不是一个事务

答：
在 `innodb_flush_log_at_trx_commit=1` 且启用组提交的情况下：
- **已成功提交的事务（客户端收到确认）绝对不会丢失**，组提交仅优化刷盘效率，不影响持久性保证；
- 停机时可能存在 “正在组提交中、未完成的事务”，但这些事务本就未被标记为成功，不属于 “丢失已提交事务”，因此不存在 “丢失一组已提交事务” 的情况。


