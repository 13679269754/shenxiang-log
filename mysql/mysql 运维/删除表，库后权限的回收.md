MySQL çš„æŽˆæƒä¸ä»…å¯ä»¥æ˜¯ `research.*`ï¼Œè¿˜å¯èƒ½æ˜¯ `research.tablename` è¿™æ ·çš„å½¢å¼ã€‚æˆ‘ä»¬å¾—æŠŠè¿™ä¸¤ç§éƒ½è€ƒè™‘è¿›åŽ»ã€‚

ä¸‹é¢æ˜¯å‡çº§ç‰ˆçš„è„šæœ¬ï¼Œå®ƒä¼šè¯†åˆ«ï¼š

- `ON research.*`
- `ON research.tablename`
- `ON \`research`.*`
- `ON \`research`.`tablename``

å¹¶ç”Ÿæˆå¯¹åº”çš„ `REVOKE` è¯­å¥ã€‚

---

### ðŸ› ï¸ å‡çº§ç‰ˆ Bash è„šæœ¬ï¼šæ’¤é”€æ‰€æœ‰ `research` åº“ç›¸å…³æƒé™

```bash
#!/bin/bash

MYSQL="mysql -uroot -p'your_password' -N -B"
TARGET_DB="research"
USER_LIST_FILE="user_list.txt"
OUTPUT_SQL="revoke_research_privs.sql"

> "$OUTPUT_SQL"

while read -r USER_ENTRY; do
    USER=$(echo "$USER_ENTRY" | cut -d'@' -f1 | tr -d "'")
    HOST=$(echo "$USER_ENTRY" | cut -d'@' -f2 | tr -d "'")

    echo "-- Checking $USER@$HOST" >> "$OUTPUT_SQL"

    GRANTS=$($MYSQL -e "SHOW GRANTS FOR '$USER'@'$HOST';")

    while read -r GRANT_LINE; do
        # åŒ¹é…æ‰€æœ‰ research.* æˆ– research.è¡¨å çš„æŽˆæƒ
        if echo "$GRANT_LINE" | grep -qE "ON \`?$TARGET_DB\`?\.\*|ON \`?$TARGET_DB\`?\.\`?[a-zA-Z0-9_]+\`?"; then
            # æå–æƒé™å’Œå¯¹è±¡
            PRIVS=$(echo "$GRANT_LINE" | sed -n "s/^GRANT \(.*\) ON .\+ TO.*/\1/p")
            OBJECT=$(echo "$GRANT_LINE" | sed -n "s/^GRANT .* ON \(.*\) TO.*/\1/p")
            echo "REVOKE $PRIVS ON $OBJECT FROM '$USER'@'$HOST';" >> "$OUTPUT_SQL"
        fi
    done <<< "$GRANTS"

done < "$USER_LIST_FILE"

echo "ç”Ÿæˆå®Œæˆï¼š$OUTPUT_SQL"
```

### ðŸ“„ user_list.txt ç¤ºä¾‹å†…å®¹ï¼ˆä½ å¯ä»¥å¤åˆ¶ä½ é‚£å †ç”¨æˆ·è¿›åŽ»ï¼‰ï¼š

```
SELECT CONCAT(USER,'@','''',HOST,'''') FROM mysql.user WHERE USER NOT IN ('mysql.infoschema','mysql.session','mysql.sys','root') AND HOST NOT IN ('localhost');
```

```
'app_dzj_read'@'%'
'app_dzj_rw'@'%'
'app_dzj_rwuser'@'%'
'archery_user'@'%'
'dba_guanxin'@'%'
...
```

---

### ðŸ§ª ä½¿ç”¨æ–¹å¼ï¼š

1. æŠŠè„šæœ¬ä¿å­˜ä¸º `gen_revoke.sh`ï¼›
2. æŠŠç”¨æˆ·åˆ—è¡¨ä¿å­˜ä¸º `user_list.txt`ï¼›
3. ä¿®æ”¹è„šæœ¬ä¸­çš„ `your_password`ï¼›
4. è¿è¡Œè„šæœ¬ï¼š

```bash
bash gen_revoke.sh
```
---

### ç¤ºä¾‹è¾“å‡ºï¼ˆè‡ªåŠ¨ç”Ÿæˆçš„ SQLï¼‰ï¼š

```sql
REVOKE SELECT, INSERT ON `research`.* FROM 'app_dzj_rw'@'%';
REVOKE SELECT ON `research`.`sensitive_table` FROM 'dzj_reporter'@'%';
```

---

è¿™ä¸ªè„šæœ¬ä¼šå¸®ä½ å½»åº•æ¸…ç†æŽ‰æ‰€æœ‰ `research` åº“ç›¸å…³çš„æŽˆæƒï¼Œæ— è®ºæ˜¯åº“çº§åˆ«è¿˜æ˜¯è¡¨çº§åˆ«ã€‚ðŸ§¹

å¦‚æžœä½ æƒ³è®©å®ƒç›´æŽ¥æ‰§è¡Œ revoke è€Œä¸æ˜¯ç”Ÿæˆ SQL æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åŠ ä¸ªé€‰é¡¹æ¥æŽ§åˆ¶ã€‚è¦æˆ‘å¸®ä½ åŠ ä¸Šå—ï¼ŸðŸ¦Š